<!doctype html>
<ãƒ¡ã‚¿æ–‡å­—ã‚»ãƒƒãƒˆ="utf-8">
<meta name="viewport" content="width=ãƒ‡ãƒã‚¤ã‚¹å¹…ã€åˆæœŸã‚¹ã‚±ãƒ¼ãƒ«=1ã€ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆãƒ•ã‚£ãƒƒãƒˆ=ã‚«ãƒãƒ¼">
<title>ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼</title>
<ã‚¹ã‚¿ã‚¤ãƒ«>
  :root{--bg:#0d1117;--card:#111827;--line:#263244;--fg:#e6edf3;--muted:#9aa6b2;--link:#58a6ff}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP","Yu Gothic",Meiryo,Arial,sans-serif;background:var(--bg);color:var(--fg);margin:24px}
  h1{ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º:20px;ãƒãƒ¼ã‚¸ãƒ³:0 0 10px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:12px}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
  ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢{å¹…:100%;æœ€å°é«˜ã•:120px;èƒŒæ™¯:#0b1220;è‰²:var(--fg);å¢ƒç•Œç·š:1pxå®Ÿç·švar(--line);å¢ƒç•Œç·šã®åŠå¾„:10px;ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°:8px;è¡Œã®é«˜ã•:1.4;ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º:16px}
  input[type="number"], select{background:#0b1220;color:var(--fg);border:1px solid var(--line);border-radius:8px;padding:6px 8px;font-size:16px}
  å…¥åŠ›[type="number"]{width:92px}
  ãƒœã‚¿ãƒ³{background:#1f2937;border:1px solid var(--line);color:var(--fg);padding:12px 14px;border-radius:12px;cursor:pointer;font-weight:700;min-height:48px;font-size:16px}
  ãƒœã‚¿ãƒ³:ãƒ›ãƒãƒ¼{èƒŒæ™¯:#263244}
  ãƒœã‚¿ãƒ³:ã‚¢ã‚¯ãƒ†ã‚£ãƒ–{transform:translateY(1px);ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼:æ˜ã‚‹ã•(1.05)}
  .result{white-space:pre-wrap;background:#0b1220;border:1px dashed var(--line);border-radius:10px;padding:10px;min-height:120px;margin-top:8px}
  .small{color:var(--muted);ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º:12px}
  .pill{display:inline-block;padding:4px 8px;border:1px solid var(--line);border-radius:999px;margin:4px 6px 0 0}
  .sticky-actions{
    ä½ç½®: ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼; ä¸‹éƒ¨: 0; è¡¨ç¤º: ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹; ã‚®ãƒ£ãƒƒãƒ—: 8px;
    padding:10px calc(10px + env(ã‚»ãƒ¼ãƒ•ã‚¨ãƒªã‚¢ã‚¤ãƒ³ã‚»ãƒƒãƒˆå³)) calc(10px + env(ã‚»ãƒ¼ãƒ•ã‚¨ãƒªã‚¢ã‚¤ãƒ³ã‚»ãƒƒãƒˆä¸‹éƒ¨)) calc(10px + env(ã‚»ãƒ¼ãƒ•ã‚¨ãƒªã‚¢ã‚¤ãƒ³ã‚»ãƒƒãƒˆå·¦));
    èƒŒæ™¯: rgba(13,17,23,.8); èƒŒæ™¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼: ã¼ã‹ã—(8px); ä¸Šå¢ƒç•Œç·š: 1px å®Ÿç·š var(--line); z-index:50
  }
  .sticky-actions ãƒœã‚¿ãƒ³{flex:1}
  @media (æœ€å¤§å¹…: 640px){
    .grid{ã‚°ãƒªãƒƒãƒ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåˆ—:1fr;ã‚®ãƒ£ãƒƒãƒ—:12px}
    .row{ã‚®ãƒ£ãƒƒãƒ—:6px}
    .row > ãƒœã‚¿ãƒ³{flex:1}
    ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢{æœ€å°é«˜ã•:140px}
  }
  ãƒ•ãƒƒã‚¿ãƒ¼{margin-top:30px;text-align:center;color:var(--muted);font-size:12px}
  a{color:var(--link);ãƒ†ã‚­ã‚¹ãƒˆè£…é£¾:ãªã—}
</ã‚¹ã‚¿ã‚¤ãƒ«>

<h1>ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼</h1>

<div class="grid">
  <!-- â‘  é †ä½ï¼šãƒ©ãƒ³ãƒ€ãƒ å„ªå…ˆ + Aux1æ©æµ + P1/P2è¨­å®š -->

  <div class="card" style="grid-column:1 / -1">
    <div class="row">
      <button id="draftRandom">ãƒ©ãƒ³ãƒ€ãƒ  P1vsP2</button>
      <button id="pick3">ãƒ©ãƒ³ãƒ€ãƒ 3æš</button>
    </div>

    <div class="row">
      <button id="draftRatio">ãƒ¬ã‚·ã‚ªP1vsP2</button>
      <button id="pickRatioBuild">ãƒ¬ã‚·ã‚ª3æš</button>
    </div>
    <div class="row">
      <label class="small">æšæ•°
        <input type="number" id="cnt" value="3" min="2" max="6" inputmode="numeric">
      </ãƒ©ãƒ™ãƒ«>
    </div>

    <!-- P1/P2 ãã‚Œãã‚Œã®æœ€å°/æœ€å¤§ -->
    <span class="small" style="margin-left:8px">P1:</span>
    <label class="small">æœ€å°å€¤ <input type="number" id="p1Min" value="7" inputmode="numeric"></label>
    <label class="small">æœ€å¤§ <input type="number" id="p1Max" value="8" inputmode="numeric"></label>

    <span class="small" style="margin-left:8px">P2:</span>
    <label class="small">æœ€å°å€¤ <input type="number" id="p2Min" value="7" inputmode="numeric"></label>
    <label class="small">æœ€å¤§ <input type="number" id="p2Max" value="8" inputmode="numeric"></label>

    <!-- æ§‹ç¯‰ã§ä½¿ã†è¨­å®šã®é¸æŠ -->
    <label class="small" style="margin-left:auto;">ãƒ¬ã‚·ã‚ª3æšã®åˆ¤å®š
      <select id="buildSide">
        <option value="P1">P1 ã®è¨­å®š</option>
        <option value="P2">P2 ã®è¨­å®š</option>
      </é¸æŠ>
    </ãƒ©ãƒ™ãƒ«>
    <label class="small" style="display:flex;align-items:center;gap:6px;margin-left:auto;">
      <input type="checkbox" id="auxToggle"> Aux1ï¼ˆHATE/LOVE/APATHYï¼‰ã‚’æ„Ÿè¬
    </ãƒ©ãƒ™ãƒ«>

    <div id="out" class="result" aria-live="polite"></div>
    <!-- å…±æœ‰ãƒœã‚¿ãƒ³è¡Œï¼ˆå‹•çš„è¡¨ç¤ºï¼‰ -->
    <div id="shareRow" class="row" style="justify-content:flex-end; display:none;">
      <button id="shareBtn">å…±æœ‰</button>
      <button id="copyBtn">ã‚³ãƒ”ãƒ¼</button>
    </div>

    <!-- ä¸‹éƒ¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆè¦ªæŒ‡ç”¨ï¼‰ -->
    <div class="sticky-actions">
      <button id="runDraftRandom">ãƒ©ãƒ³ãƒ€ãƒ ãƒ‰ãƒ©ãƒ•ãƒˆ</button>
      <button id="runDraftRatio">ãƒ¬ã‚·ã‚ªãƒ‰ãƒ©ãƒ•ãƒˆ</button>
      <button id="runBuild">ãƒ¬ã‚·ã‚ªæ§‹ç¯‰</button>
    </div>
  </div>

  <!-- â‘¡ ä¸­æ®µï¼šãƒ¬ã‚·ã‚ªè¨­å®š -->
  <div class="card">
    <div class="small">ãƒ¬ã‚·ã‚ªï¼ˆåˆæœŸå€¤ï¼ã‚ãªãŸã®è¨­å®šï¼0è¨±å¯ï¼‰</div>
    <textarea id="ratioTA">FIRE=5
é—‡=5
ã‚µã‚¤ã‚­ãƒƒã‚¯=5
å«Œã„=5
æ°´=3
æ­»äº¡=3
é‡åŠ›=3
æ„›=2
ç–«ç—…=2
ãƒ©ã‚¤ãƒ•=2
ãƒ©ã‚¤ãƒˆ=1
ã‚¹ãƒ”ãƒ¼ãƒ‰=1
ã‚¹ãƒ”ãƒªãƒƒãƒˆ=1
ç„¡é–¢å¿ƒ=0
ãƒ¡ã‚¿ãƒ«=0</ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢>
    <div class="row">
      <button id="saveRatio">ãƒ¬ã‚·ã‚ªã‚’ä¿å­˜</button>
      <span class="small">ä¿å­˜ï¼ãƒ–ãƒ©ã‚¦ã‚¶ã«æ°¸ç¶šåŒ–ã€‚æ“ä½œã¯å¸¸ã«ç¾åœ¨ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã§å³åæ˜ ã•ã‚Œã¾ã™ã€‚</span>
    </div>
    <div id="ratioView" class="small" style="margin-top:8px;"></div>
  </div>

  <!-- â‘¢ ä¸‹æ®µï¼šãƒ—ãƒ­ãƒˆã‚³ãƒ«ä¸€è¦§ -->
  <div class="card">
    <div class="small">ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ˆä¸€è¦§è¡Œã”ã¨ã«1ä»¶ï¼‰</div>
    <textarea id="pool">æ­»
ç«
é‡åŠ›
äººç”Ÿ
ãƒ©ã‚¤ãƒˆ
é‡‘å±
ç–«ç—…
ã‚µã‚¤ã‚­ãƒƒã‚¯
ã‚¹ãƒ”ãƒ¼ãƒ‰
ç²¾ç¥
æš—é—‡
æ°´</textarea>
    <div class="row">
      <button id="reset">åˆæœŸåŒ–</button>
      <button id="shuffle">è¡¨ç¤ºã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
      <button id="pick1">1æšãƒ©ãƒ³ãƒ€ãƒ </button>
      <button id="clear">çµæœã‚¯ãƒªã‚¢</button>
    </div>
    <div id="ãƒãƒƒãƒ—ã‚¹"></div>
  </div>
</div>

<ã‚¹ã‚¯ãƒªãƒ—ãƒˆ>
/* ---------- å®šæ•°/çŠ¶æ…‹ ---------- */
const dMain = ["æ­»","ç«","é‡åŠ›","ç”Ÿå‘½","å…‰","é‡‘å±","ç–«ç—…","è¶…èƒ½åŠ›","é€Ÿåº¦","ç²¾ç¥","é—‡","æ°´"];
const auxSet = ["æ†ã—ã¿","æ„›","ç„¡é–¢å¿ƒ"];
const LS = { ãƒ—ãƒ¼ãƒ«: "compile.pool"ã€æ¯”ç‡: "compile.ratio"ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼: "compile.params"ã€è£œåŠ©: "compile.auxExcluded" };
const CP_LINK = "https://princetottino10-bit.github.io/compile-picker/compile_protocol_picker.html";

/* ---------- è¦ç´ å–å¾— ---------- */
const poolTA = document.getElementById('pool');
const chips = document.getElementById('chips');
const auxToggle = document.getElementById('auxToggle');
const out = document.getElementById('out');
const ratioTA = document.getElementById('ratioTA');
const ratioView = document.getElementById('ratioView');
const cntIn = document.getElementById('cnt');
const p1MinIn= ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ.getElementById('p1Min');
const p1MaxIn= ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ.getElementById('p1Max');
const p2MinIn= ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ.getElementById('p2Min');
const p2MaxIn= ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ.getElementById('p2Max');
const buildSideSel = document.getElementById('buildSide');

/* ---------- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ---------- */
é–¢æ•°uniq(è¡Œ){
  const seen=new Set(), arr=[];
  for(const s è¡Œ){ const t=(s||"").trim().toUpperCase(); if(t && !seen.has(t)){ seen.add(t); arr.push(t); } }
  arr ã‚’è¿”ã—ã¾ã™ã€‚
}
é–¢æ•° getPool(){ return uniq(poolTA.value.split(/\r?\n/)); }
é–¢æ•° setPool(list){ poolTA.value = list.join("\n"); renderChips(); }
é–¢æ•° renderChips(){ const pool=getPool(); chips.innerHTML = pool.map(p=>`<span class="pill">${p}`).join(""); }
é–¢æ•°ã‚·ãƒ£ãƒƒãƒ•ãƒ«(a){ const arr=a.slice(); for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }
é–¢æ•°sample(a,n){ return shuffle(a).slice(0, Math.min(n,a.length)); }
é–¢æ•°parseRatio(ãƒ†ã‚­ã‚¹ãƒˆ){
  const map = Object.create(null);
  for(const è¡Œ (ãƒ†ã‚­ã‚¹ãƒˆ||"").split(/\r?\n/)){
    const t=(line||"").trim(); if(!t) ç¶™ç¶š;
    const idx=t.indexOf("="); if(idx<0) ç¶™ç¶š;
    const k=t.slice(0,idx).trim().toUpperCase();
    const v=Number(t.slice(idx+1).trim());
    if(k && !isNaN(v) && v>=0) ãƒãƒƒãƒ—[k]=v; // 0è¨±å¯
  }
  ãƒãƒƒãƒ—ã‚’è¿”ã—ã¾ã™ã€‚
}
é–¢æ•° getRatioMap(){ return parseRatio(ratioTA.value); }
é–¢æ•° costOf(k){ const m=getRatioMap(); æˆ»ã‚Šå€¤ m[k] ?? 1; }
é–¢æ•° showRatioPreview(){
  const ãƒ—ãƒ¼ãƒ« = getPool()ã€R = getRatioMap();
  const rows = pool.map(k => `${k}: ${R[k] ?? 1}`);
  rateView.textContent = "æœ€æ–°ãƒ¬ã‚·ã‚ª â†’ " + rows.join(" / ");
}
é–¢æ•° saveAll(){
  localStorage.setItem(LS.poolã€poolTA.value);
  localStorage.setItem(LS.ratioã€ratioTA.value);
  localStorage.setItem(LS.params, JSON.stringify({
    cnt:+cntIn.å€¤ã€p1min:+p1MinIn.å€¤ã€p1max:+p1MaxIn.å€¤ã€
    p2min:+p2MinIn.valueã€p2max:+p2MaxIn.valueã€build:buildSideSel.value
  }));
  localStorage.setItem(LS.aux, auxToggle.checked? "1" : "0");
}
é–¢æ•°loadAll(){
  auxToggle.checked = (localStorage.getItem(LS.aux) ?? "0") === "1";
  const poolSaved = localStorage.getItem(LS.pool);
  if(poolSaved){poolTA.value = poolSaved; }
  else{ setPool(dMain.concat(auxSet)); } // åˆæœŸã¯Main+Aux1ã‚’å«ã‚€

  const rSaved = localStorage.getItem(LS.ratio); if(rSaved) ratioTA.value = rSaved;
  å®šæ•°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ = localStorage.getItem(LS.params);
  if(ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿){
    è©¦ã™{
      const p=JSON.parse(params)||{};
      cntIn.value = p.cnt ?? 3;
      p1MinIn.value = p.p1min ?? 7; p1MaxIn.value = p.p1max ?? 8;
      p2MinIn.value = p.p2min ?? 7; p2MaxIn.value = p.p2max ?? 8;
      if(p.build) buildSideSel.value = p.build;
    }ã‚­ãƒ£ãƒƒãƒ(e){}
  }
  // è£œåŠ©é©ç”¨
  if(auxToggle.checked){ setPool(getPool().filter(x=>!auxSet.includes(x))); }
  ãã†ã§ãªã„å ´åˆ{ const cur=getPool(); const add=auxSet.filter(x=>!cur.includes(x)); if(add.length) setPool(cur.concat(add)); }
  renderChips(); showRatioPreview();
}
é–¢æ•°revealResult(){ out.scrollIntoView({behavior:'smooth', block:'nearest'}); }

/* ---------- å…±æœ‰ï¼šUI ã¨å‹•ä½œ ---------- */
const shareRow = document.getElementById('shareRow');
const shareBtn = document.getElementById('shareBtn');
const ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ = document.getElementById('ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³');
é–¢æ•° getShareText(){
  txt = (out.textContent || "").trim() ã¨ã—ã¾ã™ã€‚
  if(!txt.includes(CP_LINK)) txt += `\n\nğŸ”— ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼: ${CP_LINK}`;
  txt ã‚’è¿”ã—ã¾ã™ã€‚
}
é–¢æ•° updateShareButtons(){
  const has = !!(out.textContent && out.textContent.trim());
  shareRow.style.display = ã«ã¯ ? "flex" : "none" ãŒã‚ã‚Šã¾ã™ã€‚
}
shareBtn.onclick = éåŒæœŸ()=>{
  const ãƒ†ã‚­ã‚¹ãƒˆ = getShareText();
  è©¦ã™{
    if(navigator.share){ navigator.share({ text }); }
    else{ await navigator.clipboard.writeText(text); alert("å…±æœ‰APIãŒä½¿ãˆãªã„ãŸã‚ã€ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚"); }
  }catch(e){ console.warn(e); }
};
copyBtn.onclick = éåŒæœŸ()=>{
  const ãƒ†ã‚­ã‚¹ãƒˆ = getShareText();
  è©¦ã™{
    navigator.clipboard.writeText(ãƒ†ã‚­ã‚¹ãƒˆ) ã‚’å¾…æ©Ÿã—ã¾ã™ã€‚
    const old = copyBtn.textContent; copyBtn.textContent = "ã‚³ãƒ”ãƒ¼å®Œäº†";
    setTimeout(()=> copyBtn.textContent = old, 1200);
  }catch(e){alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"); }
};

/* ----------åŸºæœ¬æ“ä½œ ---------- */
document.getElementById('reset').onclick = ()=>{ let list=dMain.slice(); if(!auxToggle.checked) list=list.concat(auxSet); setPool(list); out.textContent=""; saveAll(); showRatioPreview(); updateShareButtons(); };
document.getElementById('shuffle').onclick = ()=>{ setPool(shuffle(getPool())); saveAll(); };
document.getElementById('clear').onclick = ()=>{ out.textContent=""; updateShareButtons(); };
document.getElementById('pick1').onclick = ()=>{ const p=getPool(); out.textContent = p.length?("ğŸ² 1æšãƒ©ãƒ³ãƒ€ãƒ \n"+sample(p,1)[0]):"ãƒªã‚¹ãƒˆãŒç©ºã§ã™ã€‚";æ˜ã‚‰ã‹ã«çµæœ(); updateShareButtons(); };
document.getElementById('pick3').onclick = ()=>{ const p=getPool(); const n=+cntIn.value||3; out.textContent = p.length?("ğŸ² "+n+"æšãƒ©ãƒ³ãƒ€ãƒ ï¼ˆé‡è¤‡ãªã—ï¼‰\n- "+sample(p,n).join("\n- ")):"ãƒªã‚¹ãƒˆãŒç©ºã§ã™ã€‚";æ˜ã‚‰ã‹ã«çµæœ(); updateShareButtons(); };
document.getElementById('saveRatio').onclick = ()=>{ localStorage.setItem(LS.ratio, ratioTA.value); showRatioPreview(); };
auxToggle.addEventListener('change', ()=>{ let l=getPool(); if(auxToggle.checked){ setPool(l.filter(x=>!auxSet.includes(x))); } else { for(const x of auxSet) if(!l.includes(x)) l.push(x); setPool(l); } saveAll(); showRatioPreview(); });
[poolTAã€ratioTAã€cntInã€p1MinInã€p1MaxInã€p2MinInã€p2MaxInã€buildSideSel].forEach(el=>el.addEventListener('input'ã€saveAll));

/* ä¸‹éƒ¨å›ºå®šãƒãƒ¼ â†’ æ—¢å­˜ãƒœã‚¿ãƒ³ã‚’ãƒˆãƒªã‚¬ãƒ¼ */
document.getElementById('runDraftRandom').onclick = ()=> document.getElementById('draftRandom').click();
document.getElementById('runDraftRatio').onclick = ()=> document.getElementById('draftRatio').click();
document.getElementById('runBuild').onclick = ()=> document.getElementById('pickRatioBuild').click();

/* ---------- ãƒ¬ã‚·ã‚ªåˆ¶ï¼šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆé«˜é€Ÿç‰ˆï¼‰ ---------- */
é–¢æ•°enumerateCombos(ãƒ—ãƒ¼ãƒ«ã€Nã€minSumã€maxSumã€costFn){
  const items = pool.map(k=>({k, c: costFn(k)})).sort((a,b)=>ac-bc);
  const ã‚­ãƒ¼ = items.map(x=>xk);
  const ã‚³ã‚¹ãƒˆ = items.map(x=>xc);

  const ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ = æ–°ã—ã„é…åˆ—(costs.length+1).fill(0);
  for(let i=0;i<costs.length;i++) prefix[i+1] = prefix[i] + cost[i];

  å®šæ•° res=[];
  const pick = æ–°ã—ã„é…åˆ—(N);

  é–¢æ•° rec(é–‹å§‹, æ·±ã•, åˆè¨ˆ){
    const æ®‹ã‚Š = N - æ·±ã•;
    æ®‹ã‚Š>0ã®å ´åˆ
      const minTail = prefix[start+remain] - prefix[start];
      if(sum + minTail > maxSum) return; // ä¸Šé™è¶…ãˆç¢ºå®šâ†’æåˆˆã‚Š
    }
    if(æ·±ã•===N){
      if(sum>=minSum && sum<=maxSum) res.push({ set:new Set(pick), arr: pick.slice(), s: sum });
      æˆ»ã‚‹;
    }
    for(let i=start; i<=keys.length - remain; i++){
      const c = ã‚³ã‚¹ãƒˆ[i];
      if(sum + c > maxSum) ãƒ–ãƒ¬ãƒ¼ã‚¯; //æ˜‡é †ãªã®ã§ã“ã‚Œä»¥é™ã‚‚ã‚ªãƒ¼ãƒãƒ¼
      pick[depth] = keys[i];
      rec(i+1, æ·±ã•+1, åˆè¨ˆ + c);
    }
  }
  ãƒ¬ã‚³ãƒ¼ãƒ‰0, 0, 0;
  res ã‚’è¿”ã—ã¾ã™ã€‚
}

/* ---------- ãƒ¬ã‚·ã‚ªåˆ¶ï¼š1äººåˆ†æ§‹ç¯‰ï¼ˆP1è¨­å®š or P2è¨­å®šã§åˆ¤å®šï¼‰ ---------- */
document.getElementById('pickRatioBuild').onclick = ()=>{
  const ãƒ—ãƒ¼ãƒ« = getPool()ã€N = + cntIn.value;
  if(pool.length<N){ out.textContent=" ãƒ—ãƒ¼ãƒ«ãŒè¶³ã‚Šã¾ã›ã‚“ï¼ˆ"+N+" ä»¥ä¸Šå¿…è¦ï¼‰ã€‚";æ˜ã‚‰ã‹ã«çµæœ(); updateShareButtons();æˆ»ã‚‹; }

  const rateMap = getRatioMap();
  const cost = k => (ratioMap[k] ?? 1);

  const side = buildSideSel.value; // "P1" ã¾ãŸã¯ "P2"
  const minS = side==="P1" ? +p1MinIn.value : +p2MinIn.value;
  const maxS = side==="P1" ? +p1MaxIn.value : +p2MaxIn.value;

  const combos = enumerateCombos(ãƒ—ãƒ¼ãƒ«ã€Nã€minSã€maxSã€ã‚³ã‚¹ãƒˆ);
  if(!combos.length){
    const ã‚³ã‚¹ãƒˆ = pool.map(cost).sort((a,b)=>ab);
    const minPossible = ã‚³ã‚¹ãƒˆ.ã‚¹ãƒ©ã‚¤ã‚¹(0, N).reduce((a,b)=>a+b,0);
    const maxPossible = ã‚³ã‚¹ãƒˆ.ã‚¹ãƒ©ã‚¤ã‚¹(-N).å‰Šæ¸›((a,b)=>a+b,0);
    out.textContent=`æ¡ä»¶ï¼ˆ${side}è¨­å®š:åˆè¨ˆ${minS}ã€œ${maxS} / ${N}æšï¼‰ã«è©²å½“ã™ã‚‹çµ„ã¿åˆã‚ã›ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚\nãƒ’ãƒ³ãƒˆï¼šã“ã®ãƒ—ãƒ¼ãƒ«ç†è«–ä¸Šã®æœ€å°=${minPossible}, æœ€å¤§=${maxPossible}ã§ã™ã€‚Min/Maxã‚„ãƒ¬ã‚·ã‚ªã‚’è¦‹ç›´ã—ã¦ãã ã•ã„ã€‚`;
    revealResult(); updateShareButtons(); æˆ»ã‚Šå€¤;
  }

  const pick = combos[Math.floor(Math.random()*combos.length)];
  const ã¯ pick.arr.map(k => `${k}(${cost(k)})`).join("\n- "); ã‚’ãƒªã‚¹ãƒˆã—ã¾ã™ã€‚
  out.textContent = `ğŸ§® ãƒ¬ã‚·ã‚ªåˆ¶ãƒ‡ãƒƒã‚­æ§‹ç¯‰ï¼ˆ${side}è¨­å®š / ${minS}ã€œ${maxS} / ${N}æšï¼‰\n- ${listed}\nåˆè¨ˆ: ${pick.s}\n\nğŸ”— ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼: ${CP_LINK}`;
  çµæœã‚’è¡¨ç¤ºã—ã¾ã™(); å…±æœ‰ãƒœã‚¿ãƒ³ã‚’æ›´æ–°ã—ã¾ã™();
};

/* ---------- ãƒ¬ã‚·ã‚ªåˆ¶ï¼šã‚ãšã‹ï¼ˆP1â†’æ®‹ã‚Šã‹ã‚‰P2æ¢ç´¢ï¼‰ ---------- */
document.getElementById('draftRatio').onclick = ()=>{
  const ãƒ—ãƒ¼ãƒ« = getPool()ã€N = + cntIn.value;
  if(pool.length < 2*N){ out.textContent=" ãƒ—ãƒ¼ãƒ«ãŒå°‘ãªã™ãã¾ã™ï¼ˆ"+(2*N)+" ä»¥ä¸Šå¿…è¦ï¼‰ã€‚";æ˜ã‚‰ã‹ã«çµæœ(); updateShareButtons();æˆ»ã‚‹; }

  const rateMap = getRatioMap();
  const cost = k => (ratioMap[k] ?? 1);

  å®šæ•° p1Min=+p1MinIn.valueã€p1Max=+p1MaxIn.value;
  å®šæ•° p2Min=+p2MinIn.valueã€p2Max=+p2MaxIn.value;

  const p1Combos = enumerateCombos(ãƒ—ãƒ¼ãƒ«ã€Nã€p1Minã€p1Maxã€ã‚³ã‚¹ãƒˆ);
  if(!p1Combos.length){ out.textContent=`P1 æ¡ä»¶ï¼ˆåˆè¨ˆ${p1Min}ã€œ${p1Max} / ${N}æšï¼‰ã‚’æº€ãŸã™ã‚»ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚`;æ˜ã‚‰ã‹ã«çµæœ(); updateShareButtons();æˆ»ã‚‹; }

  const p1Order = ã‚·ãƒ£ãƒƒãƒ•ãƒ«(p1Combos);
  best=null ã¨ã—ã¾ã™ã€‚
  for(const c1 of p1Order){
    const æ®‹ã‚Šã®ãƒ—ãƒ¼ãƒ« = pool.filter(x=>!c1.set.has(x));
    ã‚‚ã—remainPool.length<Nã§ã‚ã‚Œã°ç¶™ç¶šã—ã¾ã™ã€‚
    const p2Combos = enumerateCombos(remainPoolã€Nã€p2Minã€p2Maxã€ã‚³ã‚¹ãƒˆ);
    if(p2Combos.length){ best=[c1, p2Combos[Math.floor(Math.random()*p2Combos.length)]]; break; }
  }
  if(!best){ out.textContent="å…¨ä½“çš„ã«é‡è¤‡ã—ãªã„ 2 ã‚»ãƒƒãƒˆã¯ä½œã‚Šã¾ã›ã‚“ã€‚ãƒ—ãƒ¼ãƒ«ã‚„å„æ¡ä»¶ã‚’è¦‹ç›´ã—ã¦ãã ã•ã„ã€‚";æ˜ã‚‰ã‹ã«çµæœ(); updateShareButtons();æˆ»ã‚‹; }

  const first = Math.random()<0.5 ? "P1" : "P2"; // å…ˆæ”»
  å®šæ•°P1 = best[0].arr.slice()ã€P2 = best[1].arr.slice();
  const fmt = a => a.map((k,i)=>`${i+1}. ${k}(${cost(k)})`).join("\n");
  const æ®‹ã‚Š = pool.filter(x=>!P1.includes(x)&&!P2.includes(x));

  out.textContent =
`ğŸŒ€ ãƒ¬ã‚·ã‚ªåˆ¶ãƒ‰ãƒ©ãƒ•ãƒˆï¼ˆå„${N}æšï¼‰
å…ˆæ”»: ${first}

P1åˆè¨ˆ=${best[0].s}ï¼ˆæ¡ä»¶${p1Min}ã€œ${p1Max}ï¼‰
${fmt(P1)}

P2åˆè¨ˆ=${best[1].s}ï¼ˆæ¡ä»¶${p2Min}ã€œ${p2Max}ï¼‰
${fmt(P2)}

æ®‹ã‚Šã®ãƒ—ãƒ¼ãƒ« (${remain.length})
- ${remain.join(", ")}

ğŸ”— ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼: ${CP_LINK}`;
  çµæœã‚’è¡¨ç¤ºã—ã¾ã™(); å…±æœ‰ãƒœã‚¿ãƒ³ã‚’æ›´æ–°ã—ã¾ã™();
};

/* ---------- å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ï¼šæŒ‡åï¼ˆã‚³ã‚¹ãƒˆç„¡è¦–ï¼‰ ---------- */
é–¢æ•° makeSnakeSequence(nEach){
  const pat=[["P1",1],["P2",2],["P1",2],["P2",1]];
  const rem={P1:nEach, P2:nEach}, seq=[]; i=0 ã¨ã™ã‚‹;
  while(rem.P1>0 || rem.P2>0){
    const [w,t]=pat[i%pat.length]ã€take=Math.min(t, rem[w]);
    take>0ã®å ´åˆã€seq.push([w,take]); rem[w]-=take; }
    i++; if(i>200) ãƒ–ãƒ¬ãƒ¼ã‚¯;
  }
  seq ã‚’è¿”ã—ã¾ã™ã€‚
}
document.getElementById('draftRandom').onclick = ()=>{
  const ãƒ—ãƒ¼ãƒ« = getPool().slice();
  å®šæ•° N = +cntIn.value;
  if(pool.length < 2*N){ out.textContent = `ãƒ—ãƒ¼ãƒ«ãŒè¶³ã‚Šã¾ã›ã‚“ï¼ˆ${2*N}ä»¥ä¸Šå¿…è¦ï¼‰ã€‚`;æ˜ã‚‰ã‹ã«çµæœ(); updateShareButtons();æˆ»ã‚‹; }

  const first = Math.random()<0.5 ? 'P1' : 'P2';
  const bag = shuffle(pool);
  const seq = makeSnakeSequence(N).map(([who,take])=> first==='P1' ? [who,take] : [who==='P1'?'P2':'P1',take]);
  const picks={P1:[],P2:[]};
  for(const [who,take] of seq){ picks[who].push(...bag.splice(0,take)); }

  const fmt = a => a.map((k,i)=>`${i+1}. ${k}`).join("\n");
  out.textContent =
`ğŸ²å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ æŒ‡åï¼ˆå„${N}æšï¼ã‚³ã‚¹ãƒˆç„¡è¦–ï¼‰
å…ˆæ”»: ${first}

P1
${fmt(picks.P1)}

P2
${fmt(picks.P2)}

æ®‹ã‚Šã®ãƒ—ãƒ¼ãƒ« (${bag.length})
- ${bag.join(", ")}

ğŸ”— ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼: ${CP_LINK}`;
  çµæœã‚’è¡¨ç¤ºã—ã¾ã™(); å…±æœ‰ãƒœã‚¿ãƒ³ã‚’æ›´æ–°ã—ã¾ã™();
};

/* ---------- åˆæœŸåŒ– ---------- */
if(!localStorage.getItem(LS.ratio)) localStorage.setItem(LS.ratioã€document.getElementById('ratioTA').value);
if(!localStorage.getItem(LS.params)){
  ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¨­å®šã™ã‚‹ã«ã¯ã€LS.paramsã€JSON.stringify({cnt:3ã€p1min:7ã€p1max:8ã€p2min:7ã€p2max:8ã€build:"P1"}) ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
}
if(localStorage.getItem(LS.aux)===null) localStorage.setItem(LS.aux,"0");
if(!localStorage.getItem(LS.pool)){
  localStorage.setItem(LS.poolã€dMain.concat(auxSet).join("\n"));
}
ã™ã¹ã¦ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™();
</ã‚¹ã‚¯ãƒªãƒ—ãƒˆ>

<ãƒ•ãƒƒã‚¿ãƒ¼>
  Â© 2025 ã‚Šã‚…ãƒ¼ (@suke69) â€” <a href="https://x.com/suke69" target="_blank">https://x.com/suke69</a>
</ãƒ•ãƒƒã‚¿ãƒ¼>
